# ğŸ¿ï¸ DecoupledIO å¢å¼ºç‰ˆä¹‹ StreamIO

åœ¨æ•°å­—ç”µè·¯è®¾è®¡ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä½¿ç”¨ Ready/Valid æ¡æ‰‹åè®®æ¥è§£è€¦æ•°æ®æµï¼ŒChisel æä¾›äº† `DecoupledIO` ç”¨ä»¥å®ç°è¿™ä¸€åè®®ã€‚ç„¶è€Œï¼Œ`DecoupledIO` ä»…æ˜¯ä¸€ä¸ªé¢„ç½®çš„ `Bundle`ï¼Œç¼ºå°‘ä¸ä¹‹é…å¥—çš„ä¸€ç³»åˆ—å¸¸ç”¨ç»„ä»¶ï¼ˆä¾‹å¦‚å¯„å­˜å™¨åˆ‡ç‰‡ã€Mux/Demux ç­‰ï¼‰ï¼Œæ­¤å¤–å®ƒä¹Ÿæœªèƒ½æ­é… `chipmunk.IsMasterSlave`ã€‚`chipmunk` ä¸º `DecoupledIO` æä¾›äº†ä¸€ä¸ªâ€œå¨åŠ›åŠ å¼ºç‰ˆâ€çš„ Ready/Valid æ¡æ‰‹åè®®â€”â€”`chipmunk.StreamIO`ã€‚

## Ready/Valid æ¡æ‰‹åè®®

![Ready/Valid Interface](./assets/stream-ready-valid-protocol.png)

Ready/Valid æ¡æ‰‹åè®®ç”±ä¸‰éƒ¨åˆ†ä¿¡å·ç»„æˆï¼š
- `valid`ï¼šè¡¨ç¤ºæ•°æ®æœ‰æ•ˆï¼Œå³ä¸Šæ¸¸æ•°æ®å·²ç»å‡†å¤‡å¥½ï¼Œå¯ä»¥è¢«æ¶ˆè´¹ï¼›
- `ready`ï¼šè¡¨ç¤ºæ•°æ®å¯è¢«æ¶ˆè´¹ï¼Œå³ä¸‹æ¸¸å·²ç»å‡†å¤‡å¥½æ¥æ”¶æ•°æ®ï¼›
- `bits`ï¼ˆå³ `payload`ï¼‰ï¼šè¡¨ç¤ºæ•°æ®æœ¬èº«ã€‚

å…¶ä¸­ï¼Œ`valid` å’Œ `bits` ä¿¡å·ç”±ä¸Šæ¸¸äº§ç”Ÿï¼Œ`ready` ä¿¡å·ç”±ä¸‹æ¸¸äº§ç”Ÿã€‚å½“ `valid` å’Œ `ready` ä¿¡å·åŒæ—¶æœ‰æ•ˆæ—¶ï¼Œ`bits` ä¿¡å·è¢«ä¼ é€’ï¼Œå³æ•°æ®è¢«æ¶ˆè´¹ã€‚åˆ©ç”¨è¿™ä¸€åè®®ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ•°æ®æµçš„ç”Ÿäº§å’Œæ¶ˆè´¹è§£è€¦ï¼šä¸Šæ¸¸æ¨¡å—åªéœ€è¦åœ¨å‡†å¤‡å¥½æ•°æ®åå°† `valid` å’Œ `bits` ä¿¡å·ç½®ä¸ºæœ‰æ•ˆï¼Œè€Œæ— éœ€å…³å¿ƒä¸‹æ¸¸æ¨¡å—å†…éƒ¨çš„çŠ¶æ€ï¼›è€Œä¸‹æ¸¸æ¨¡å—åªéœ€è¦åœ¨å‡†å¤‡å¥½æ¥æ”¶æ•°æ®åå°† `ready` ä¿¡å·ç½®ä¸ºæœ‰æ•ˆï¼Œå½“ `valid` å’Œ `ready` ä¿¡å·åŒæ—¶æœ‰æ•ˆæ—¶å–èµ° `bits` æ•°æ®ã€‚é€šè¿‡ä½¿ç”¨ Ready/Valid æ¡æ‰‹åè®®ï¼Œå¼€å‘è€…å¯ä»¥å°†æ³¨æ„åŠ›é›†ä¸­åœ¨è‡ªå·±è´Ÿè´£çš„ç”µè·¯é€»è¾‘ä¸Šï¼Œè€Œæ— éœ€è¿‡åº¦å…³å¿ƒå…¶ä»–æ¨¡å—çš„å†…éƒ¨å®ç°ï¼Œä»è€Œæé«˜å¼€å‘æ•ˆç‡ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ºäº†é¿å…ç»„åˆé€»è¾‘ç¯è·¯ï¼Œæˆ‘ä»¬è¦æ±‚ `valid`ï¼ˆåŠ `bits`ï¼‰å’Œ `ready` ä¿¡å·ä¸èƒ½åŒæ—¶ä¾èµ–å¯¹æ–¹çš„å½“å‰çŠ¶æ€ã€‚å› æ­¤ï¼Œåœ¨ Chipmunkï¼ˆå’Œå…¶ä»–ç»å¤§å¤šæ•°æ•°å­—ç”µè·¯è®¾è®¡ï¼‰ä¸­ï¼Œæˆ‘ä»¬çº¦å®š `valid` ä¸å…è®¸ä¾èµ–äº `ready` çš„å½“å‰çŠ¶æ€ï¼Œå³ä¸Šæ¸¸æ¨¡å—ä¸å…è®¸æ ¹æ®ä¸‹æ¸¸æ¨¡å—æ­¤åˆ»æ˜¯å¦ `ready` æ¥å†³å®šå½“å‰å‘¨æœŸæ˜¯å¦å°† `valid` ç½®ä¸ºæœ‰æ•ˆã€‚ç®€å•åœ°è¯´ï¼Œç”¨äº `valid` äº§ç”Ÿçš„ç»„åˆé€»è¾‘è¡¨è¾¾å¼ä¸­ä¸èƒ½å‡ºç°ä¸‹æ¸¸æ¨¡å—çš„ `ready` ä¿¡å·ã€‚

å…³äº Ready/Valid æ¡æ‰‹åè®®çš„æ›´å¤šç»†èŠ‚ï¼Œç½‘ä¸Šå·²ç»æœ‰äº†ä¸°å¯Œçš„ææ–™å¯ä»¥å‚è€ƒï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚

## å…³äº `StreamIO`

### Why?

Chisel æä¾›äº† `DecoupledIO` å’Œ `IrrevocableIO` ä¸¤ä¸ª Ready/Valid æ¡æ‰‹åè®®çš„ `Bundle` å®ç°ï¼Œå®ƒä»¬éƒ½ç»§æ‰¿è‡ª `chisel3.ReadyValidIO`ã€‚Chisel å¹¶æœªä¸ºè¿™ä¸¤ä¸ªæ¥å£æä¾›å¤ªå¤š APIï¼ŒåŸºæœ¬ä¸Šåªæœ‰ï¼š
- `def fire: Bool = ready && valid`ï¼Œè¡¨ç¤ºå½“å‰å‘¨æœŸæ˜¯å¦å‘ç”Ÿäº†æ•°æ®ä¼ è¾“ï¼›
- `class Queue`ï¼Œä»¥ `ReadyValidIO` ä¸ºæ¥å£çš„åŒæ­¥ FIFOï¼›
- `def map[T](f: T => T2): T`ï¼Œç”¨äºå¯¹ `bits` è¿›è¡Œå˜æ¢ã€‚

`IrrevocableIO` å…¶å®åœ¨å®ç°ä¸Š `DecoupledIO` å¹¶æ— åŒºåˆ«ï¼Œåªæ˜¯çº¦å®šå®ƒçš„ `bits` åœ¨ `valid` æœ‰æ•ˆä½† `ready` æ— æ•ˆæ—¶ä¸ä¼šæ”¹å˜ï¼Œå³æ•°æ®ä¸å¯æ’¤å›ã€‚ä¸¤è€…çš„å®é™…å·®åˆ«æœ‰èµ–äºå…·ä½“æ¨¡å—ä¸­çš„ç”µè·¯å®ç°ã€‚

å¾ˆæ˜¾ç„¶ï¼Œä¸Šè¿° API ä¸è¶³ä»¥åº”ä»˜å®é™…çš„è®¾è®¡éœ€æ±‚ã€‚

Chipmunk åœ¨ `chisel3.ReadyValidIO` çš„åŸºç¡€ä¸Šæä¾›äº† `chipmunk.StreamIO`ï¼Œå®ƒç»§æ‰¿è‡ª `chisel3.ReadyValidIO`ï¼Œå¹¶æä¾›äº†ä¸€ç³»åˆ—å¸¸ç”¨çš„ API å’Œç‰¹æ€§ï¼ŒåŒ…æ‹¬ï¼š
- ä¸€ç³»åˆ—ç±»ä¼¼`fire` çš„è¯­æ³•ç³–ï¼Œå±•ç°æ•°æ®ä¼ è¾“çš„ä¸åŒçŠ¶æ€ï¼›
- ç¬¦å·åŒ–çš„è¿æ¥æ–¹æ³•ï¼Œç±»ä¼¼ `a >> b >-> c`ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°çœ‹å‡ºæ•°æ®çš„æµå‘ï¼›
- é’ˆå¯¹ `bits` çš„ä¸€ç³»åˆ—æ“ä½œï¼ŒåŒ…æ‹¬ Mapã€Cast ç­‰ï¼›
- ä¸€ç³»åˆ—å¸¸ç”¨çš„ç»„ä»¶ï¼ŒåŒ…æ‹¬å¯„å­˜å™¨åˆ‡ç‰‡ï¼ˆRegister Sliceï¼‰ã€Fork/Joinã€Mux/Demux ç­‰ã€‚

`StreamIO` åœ¨å®ç°ä¸Šå‚è€ƒäº† [SpinalHDL](https://spinalhdl.github.io/SpinalDoc-RTD/master/SpinalHDL/Libraries/stream.html) çš„ `Stream` çš„ API è®¾è®¡ï¼Œç†Ÿæ‚‰ SpinalHDL çš„åŒå­¦åº”è¯¥ä¼šæœ‰ä¸€ä¸ç†Ÿæ‚‰çš„æ„Ÿè§‰ã€‚

### Usage

#### StreamIO ä¾‹åŒ–

- åˆ›å»ºä¸€ä¸ª `StreamIO`ï¼Œå…¶ `payload` ç±»å‹ä¸º `UInt`ï¼š
```scala
val myStream = Wire(Stream(UInt(32.W)))
```

- åˆ›å»ºä¸€ä¸ª `StreamIO`ï¼Œå…¶ `payload` ç±»å‹å’Œå¦ä¸€ä¸ª `DecoupledIO` çš„ `bits` ä¸€è‡´ï¼š
```scala
val myDecoupled = Wire(Decoupled(UInt(32.W)))
val myStream = Wire(Stream(myDecoupled))
```
è¯·æ³¨æ„è¿™é‡Œ `myStream` ä¸ä¼šä¸ `myDecoupled` æœ‰ä»»ä½•ç”µè·¯è¿æ¥ï¼ˆæ¯”å¦‚å…±äº« `bits`ï¼‰ï¼Œè€Œæ˜¯ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ `UInt` ä½œä¸º `payload`ã€‚

- åˆ›å»ºä¸€ä¸ªç©ºçš„ `StreamIO`ï¼ˆå³å…¶ `payload` ç±»å‹ä¸º `EmptyBundle`ï¼‰ï¼š
```scala
val myStream = Wire(Stream.empty)
```
ç©ºçš„ `StreamIO` ä¸€èˆ¬ç”¨äºå£°æ˜æ—¶æ²¡æœ‰ç¡®å®š `payload` ç±»å‹çš„æƒ…å†µï¼Œåç»­å¯ä»¥æ­é… `payloadReplace` ç­‰ API èµ‹äºˆå…·ä½“çš„ `payload`ã€‚

#### æµæ§ä¸çŠ¶æ€æŒ‡ç¤º

`StreamIO` æä¾›ä»¥ä¸‹çŠ¶æ€æŒ‡ç¤ºæ–¹æ³•ï¼Œå®ƒä»¬çš„è¿”å›ç±»å‹å‡ä¸º `Bool`ï¼š

| è¯­æ³•             | æè¿°                                       |
|:---------------|:-----------------------------------------|
| `x.fire`       | å½“å‰å‘¨æœŸæ­£åœ¨è¿›è¡Œæ•°æ®ä¼ è¾“ï¼Œå³ `ready && valid`          |
| `x.isPending`  | ä¸Šæ¸¸æ•°æ®å·²ç»å°±ç»ªï¼Œä½†ä¸‹æ¸¸æœªèƒ½å‡†å¤‡å¥½æ¥æ”¶ï¼Œå³ `!ready && valid`  |
| `x.isStarving` | ä¸‹æ¸¸å·²å‡†å¤‡å¥½æ¥æ”¶æ•°æ®ï¼Œä½†ä¸Šæ¸¸æ²¡æœ‰å‘èµ·ä¼ è¾“ï¼Œå³ `ready && !valid` |

`StreamIO` ä¹Ÿæä¾›ä¸‹åˆ—æ–¹æ³•å¯¹æ•°æ®æµè¿›è¡Œæµæ§ï¼Œå®ƒä»¬ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ `StreamIO`ï¼š

| è¯­æ³•                     | æè¿°                                                              |
|:-----------------------|:----------------------------------------------------------------|
| `x.haltWhen(cond)`     | å½“ `cond` ä¸º `True` æ—¶ï¼Œæ•°æ®ä¼ è¾“ä¼šè¢«é˜»æ–­ï¼Œå³ä¸Šä¸‹æ¸¸æ¨¡å—å‡æ— æ³•å®Œæˆæ¡æ‰‹ã€‚                     |
| `x.continueWhen(cond)` | ç›¸å½“äº `x.haltWhen(!cond)`                                         |
| `x.throwWhen(cond)`    | å½“ `cond` ä¸º `True` æ—¶ï¼Œæ•°æ®ä¼ è¾“ä¼šè¢«ä¸¢å¼ƒï¼Œå³ä¸Šæ¸¸æ¨¡å—å‘èµ·çš„æ•°æ®ä¼ è¾“éƒ½ä¼šæˆåŠŸæ¡æ‰‹ï¼Œä½†ä¸‹æ¸¸æ¨¡å—ä¸ä¼šæ”¶åˆ°ç›¸åº”çš„æ•°æ®ã€‚ |
| `x.takeWhen(cond)`     | ç›¸å½“äº `x.throwWhen(!cond)`                                        |

#### Payload å˜æ¢

![StreamIO Payload Operation](./assets/stream-payload-operation.png)

`StreamIO` å…è®¸å¯¹ `payload` ç›´æ¥è¿›è¡Œä¸€ç³»åˆ—å˜æ¢ï¼ŒåŒ…æ‹¬ï¼š

```scala
def payloadMap[T2 <: Data](f: T => T2): StreamIO[T2]
def payloadReplace[T2 <: Data](p: T2): StreamIO[T2]
def payloadCast[T2 <: Data](gen: T2, checkWidth: Boolean = false): StreamIO[T2]
```

ä¸Šè¿°æ–¹æ³•ä¼šè¿”å›ä¸€ä¸ªæ–°çš„ `StreamIO`ï¼Œå…¶ `payload` ä¼šå˜æˆå˜æ¢åã€ç±»å‹ä¸º `T2` çš„æ–°ä¿¡å·ï¼ŒåŒæ—¶å…¶ `ready` å’Œ `valid` ä¿¡å·ä¼šè¿æ¥åˆ°å½“å‰ `StreamIO` çš„ `ready` å’Œ `valid` ä¿¡å·ã€‚

- `payloadMap` å¯ä»¥å°†å‡½æ•° `f` ä½œç”¨äº `payload`ï¼Œæ¯”å¦‚ï¼š
```scala
val streamOld = Wire(Stream(UInt(32.W)))
val StreamNew = streamOld.payloadMap(_ + 1.U)
```

- `payloadReplace` ä¼šå°† `payload` æ›¿æ¢ä¸º `p`ï¼Œç›¸å½“äº `payloadMap(_ => p)`ï¼Œæ¯”å¦‚ï¼š
```scala
val streamOld = Wire(Stream(UInt(32.W)))
val anotherBool = Wire(Bool())
val StreamNew = streamOld.payloadReplace(anotherBool)
```

- `payloadCast` ä¼šå¯¹ `payload` è¿›è¡Œå¼ºåˆ¶ç±»å‹è½¬æ¢ï¼Œç›¸å½“äº `payloadMap(_.asTypeOf(gen))`ï¼Œæ¯”å¦‚ï¼š
```scala
val streamOld = Wire(Stream(UInt(32.W)))
val StreamNew = streamOld.payloadCast(SInt(32.W), checkWidth = true)
```
å…¶ä¸­å‚æ•° `checkWidth = true` å…è®¸æ£€æŸ¥ç±»å‹è½¬æ¢å‰åçš„ä½å®½æ˜¯å¦ä¸€è‡´ï¼Œå¦‚æœä¸ä¸€è‡´æŠ›å‡ºå¼‚å¸¸ã€‚è¯¥å‚æ•°é»˜è®¤ä¸º `false`ï¼Œå³ä¸ä¼šæ£€æŸ¥ä½å®½ï¼Œå¦‚æœä½å®½ä¸ä¸€è‡´ä¼šè‡ªåŠ¨æˆªæ–­æˆ–æ‰©å±•ã€‚

#### å¯„å­˜å™¨åˆ‡ç‰‡ï¼ˆRegister Sliceï¼‰

ä¸º `StreamIO` æ’å…¥å¯„å­˜å™¨åˆ‡ç‰‡ä»¥æ”¹å–„æ—¶åºï¼Œæ˜¯ä¸€ä¸ªå¸¸è§çš„éœ€æ±‚ã€‚ç„¶è€Œï¼Œè¿™å®ç°èµ·æ¥éå¸¸ç¹çä¸”æ˜“é”™ã€‚æ˜¾ç„¶ï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥åœ¨ `StreamIO` çš„ `ready`/`valid`/`bits` è·¯å¾„ä¸Šè´¸ç„¶æ’å…¥å¯„å­˜å™¨åˆ‡ç‰‡ã€‚`valid` å’Œ `ready` åˆ†åˆ«ä»£è¡¨å½“å‰å‘¨æœŸä¸Šæ¸¸æ¨¡å—å’Œä¸‹æ¸¸æ¨¡å—çš„çŠ¶æ€ï¼Œåœ¨å®ƒä»¬çš„ä¼ æ’­é€šè·¯ä¸Šå¼•å…¥å¯„å­˜å™¨ä¼šå¯¼è‡´çŠ¶æ€å»¶åè‹¥å¹²å‘¨æœŸæ‰ä¼šä¼ æ’­åˆ°å¯¹ä¾§ã€‚è¿™ä¼šå¯¼è‡´ä¸Šä¸‹æ¸¸æ¨¡å—æ— æ³•åœ¨æ­£ç¡®çš„æ—¶æœºå®Œæˆæ¡æ‰‹ï¼Œå¯èƒ½ä¼šå¼•èµ·æ•°æ®ä¸¢å¤±æˆ–ååä¸‹é™ã€‚

æ ¹æ®å¯„å­˜å™¨æ’å…¥ä½ç½®ä¸åŒï¼Œ`StreamIO` æä¾›ï¼š

- `pipeForward`ï¼šå‰å‘å¯„å­˜å™¨åˆ‡ç‰‡ï¼Œåˆ‡æ–­ä»ä¸Šæ¸¸æ¨¡å—åˆ°ä¸‹æ¸¸æ¨¡å—çš„ `valid` å’Œ `bits` é€šè·¯çš„ç»„åˆé€»è¾‘è·¯å¾„ï¼›
```scala
val streamNew = streamOld.pipeForward()
```
å®ƒåœ¨æ€§èƒ½ä¸Šä¸ä¼šå¼•å…¥ååä¸‹é™ï¼ˆè™½ç„¶ä¼šå¢åŠ  1 å‘¨æœŸå»¶æ—¶ï¼‰ï¼Œåœ¨é¢ç§¯ä¸Šä»£ä»·æ˜¯ N + 1 ä¸ªå¯„å­˜å™¨ï¼ˆN æ˜¯ `bits` ä½å®½ï¼‰ä»¥åŠå°‘é‡ç»„åˆé€»è¾‘ã€‚
- `pipeBackward`ï¼šåå‘å¯„å­˜å™¨åˆ‡ç‰‡ï¼Œåˆ‡æ–­ä»ä¸‹æ¸¸æ¨¡å—åˆ°ä¸Šæ¸¸æ¨¡å—çš„ `ready` é€šè·¯çš„ç»„åˆé€»è¾‘è·¯å¾„ã€‚
```scala
val streamNew = streamOld.pipeBackward()
```
å®ƒåœ¨æ€§èƒ½ä¸Šä¸ä¼šå¼•å…¥é¢å¤–çš„å»¶æ—¶å’Œååä¸‹é™ï¼Œåœ¨é¢ç§¯ä¸Šä»£ä»·æ˜¯ N + 1 ä¸ªå¯„å­˜å™¨ï¼ˆN æ˜¯ `bits` ä½å®½ï¼‰ã€N ä¸ª 2:1 MUX ä»¥åŠå°‘é‡ç»„åˆé€»è¾‘ã€‚
- `pipeAll`ï¼šåŒå‘å¯„å­˜å™¨åˆ‡ç‰‡ï¼ŒåŒæ—¶åˆ‡æ–­ `valid`ã€`bits`ã€`ready` é€šè·¯çš„ç»„åˆé€»è¾‘è·¯å¾„ã€‚
```scala
val streamNew = streamOld.pipeAll()
```
ç›¸å½“äº `streamOld.pipeForward().pipeBackward()`ï¼Œå› æ­¤å®ƒä¼šå¼•å…¥ 2N + 2 ä¸ªå¯„å­˜å™¨ï¼ˆN æ˜¯ `bits` ä½å®½ï¼‰ã€N ä¸ª 2:1 MUX ä»¥åŠå°‘é‡ç»„åˆé€»è¾‘ã€‚
- `pipeSimple`ï¼šåŒå‘å¯„å­˜å™¨åˆ‡ç‰‡ï¼ŒåŒæ—¶åˆ‡æ–­ `valid`ã€`bits`ã€`ready` é€šè·¯çš„ç»„åˆé€»è¾‘è·¯å¾„ã€‚
```scala
val streamNew = streamOld.pipeSimple()
```
å®ƒè‡³å¤šæ¯éš”ä¸€ä¸ªå‘¨æœŸæ¡æ‰‹ä¸€æ¬¡ï¼Œå› æ­¤ä¼šå¼•èµ·æœ€é«˜å¯è¾¾ä¸€åŠçš„ååæŸå¤±ï¼Œä½†é¢ç§¯ä¸Šåªéœ€è¦ N + 2 ä¸ªå¯„å­˜å™¨ä»¥åŠå°‘é‡çš„ç»„åˆé€»è¾‘ã€‚ä¸ `pipeAll` ç›¸æ¯”ï¼Œå®ƒçš„é¢ç§¯ä»£ä»·æ›´å°ï¼Œä½†ä¼šå¼•å…¥é¢å¤–çš„æ€§èƒ½æŸå¤±ã€‚
- `pipeValid`ï¼šä»…åˆ‡æ–­ `valid` é€šè·¯çš„ç»„åˆé€»è¾‘è·¯å¾„ã€‚
```scala
val streamNew = streamOld.pipeValid()
```
é¢ç§¯ä¸Šä»…éœ€è¦ 1 ä¸ªå¯„å­˜å™¨å’Œå°‘é‡ç»„åˆé€»è¾‘ã€‚
- `pipPassThrough`ï¼šä»€ä¹ˆéƒ½ä¸åšï¼Œè¿”å›å½“å‰çš„ `StreamIO`ã€‚
```scala
val streamNew = streamOld.pipPassThrough()
```

#### ç¬¦å·åŒ–è¿æ¥

`StreamIO` æä¾›äº†ä¸€ç³»åˆ—æ–¹æ³•ç”¨äºè¿æ¥å…¶ä»– `StreamIO`ï¼š

| è¯­æ³•                   | æè¿°                                                          |
|:---------------------|:------------------------------------------------------------|
| `x.connectFrom(y)`   | ç”¨ `y` é©±åŠ¨ `x`ï¼Œå³ `y` ä½œä¸º `x` çš„ä¸Šæ¸¸è¿›è¡Œè¿æ¥ `ready`ã€`valid`ã€`bits` ä¿¡å· |
| `x.handshakeFrom(y)` | å’Œ `connectFrom` ç±»ä¼¼ï¼Œä½†åªè¿æ¥ `ready`ã€`valid` ä¿¡å·ï¼Œä¸è¿æ¥ `bits` ä¿¡å·    |
| `x << y`             | ç›¸å½“äº `x.connectFrom(y)`ï¼Œè¿”å› `y`                               |
| `x >> y`             | ç›¸å½“äº `y.connectFrom(x)`ï¼Œè¿”å› `y`                               |
| `x <-< y`            | ç›¸å½“äº `x << y.pipeForward()`ï¼Œè¿”å› `y`                           |
| `x >-> y`            | ç›¸å½“äº `x.pipeForward() >> y`ï¼Œè¿”å› `y`                           |
| `x <\|< y`           | ç›¸å½“äº `x << y.pipeBackward()`ï¼Œè¿”å› `y`                          |
| `x >\|> y`           | ç›¸å½“äº `x.pipeBackward() >> y`ï¼Œè¿”å› `y`                          |
| `x <+< y`            | ç›¸å½“äº `x << y.pipeAll()`ï¼Œè¿”å› `y`                               |
| `x >+> y`            | ç›¸å½“äº `x.pipeAll() >> y`ï¼Œè¿”å› `y`                               |

å€ŸåŠ© `<<`ã€`>>` ç­‰æµæ“ä½œç¬¦ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°å¯è¯»æ€§è¾ƒå¼ºçš„ `StreamIO` è¿æ¥ç”šè‡³çº§è¿ï¼Œæ¯”å¦‚ï¼š
```scala
val s1 = Stream(UInt(8.W))
s1 <-< uAnotherModule.io.outStream
s1.haltWhen(somethingEnable) >> uSomeModule.io.inStream
```

## é…å¥—ç»„ä»¶

Chipmunk åŒ…æ‹¬äº†ä¸€ç³»åˆ— `StreamIO` çš„é…å¥—ç»„ä»¶ã€‚

### StreamFork/StreamJoin

StreamFork å¯ä»¥å°†ä¸€ä¸ªä¸Šæ¸¸ `StreamIO` åˆ†å‰æˆå¤šä¸ªä¸‹æ¸¸ `StreamIO`ï¼Œæ¯ä¸ªä¸‹æ¸¸ `StreamIO` ä¼šåˆ†åˆ«å®Œæˆä»…ä¸€æ¬¡æ¡æ‰‹ï¼Œä¸Šæ¸¸ `StreamIO` ä¼šåœ¨æ‰€æœ‰ä¸‹æ¸¸ `StreamIO` å®Œæˆæ¡æ‰‹åæ‰å®Œæˆæ¡æ‰‹ã€‚ä¸ºäº†æé«˜æ€§èƒ½ï¼Œæ¯ä¸ªä¸‹æ¸¸ `StreamIO` æ˜¯å¦æ¡æ‰‹æ˜¯ç‹¬ç«‹è¿›è¡Œçš„ï¼Œå½“å®ƒ `ready` æœ‰æ•ˆæ—¶å³å®Œæˆæ¡æ‰‹ï¼Œè€Œä¸éœ€è¦ç­‰åˆ°æ‰€æœ‰ä¸‹æ¸¸ `StreamIO` çš„ `ready` éƒ½æœ‰æ•ˆã€‚

StreamJoin å¯ä»¥å°†å¤šä¸ªä¸Šæ¸¸ `StreamIO` åˆå¹¶æˆä¸€ä¸ªä¸‹æ¸¸ `StreamIO`ï¼Œå½“ä¸”ä»…å½“æ‰€æœ‰ä¸Šæ¸¸ `StreamIO` çš„ `valid` éƒ½æœ‰æ•ˆæ—¶ï¼Œæ‰ä¼šå‘ç”Ÿæ¡æ‰‹ã€‚

åœ¨ `object StreamFork`/`object StreamJoin` ä¸­ï¼ŒChipmunk æä¾›äº†å¤šä¸ªæ¥å£ç•¥æœ‰å·®åˆ«çš„æ–¹æ³•ã€‚ç”¨æˆ·å¯ä»¥é˜…è¯»ä»£ç ä¸­çš„æ³¨é‡Šï¼Œæ ¹æ®è‡ªå·±çš„éœ€æ±‚é€‰æ‹©åˆé€‚çš„æ–¹æ³•ã€‚

### StreamMux/Demux/...

TODO
